(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[516],{2151:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>eS});var r=a(8081),n=a(2149),s=a(5327),o=a(3484),i=a(6522),l=a(4483);function c(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,l.QP)((0,i.$)(t))}let d=(0,o.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),m=n.forwardRef((e,t)=>{let{className:a,variant:n,size:o,asChild:i=!1,...l}=e,m=i?s.DX:"button";return(0,r.jsx)(m,{className:c(d({variant:n,size:o,className:a})),ref:t,...l})});m.displayName="Button";let u=e=>{let t=[];for(let a=0;a<e;a++)t.push(Array(e).fill(null));return t};var f=a(4528),g=a(394);let p=(0,f.Wp)({apiKey:"AIzaSyBtQHaTUYTqT_ApDKl29IukeXmxkpAWzzI",authDomain:"gomoku-game-p2p.firebaseapp.com",databaseURL:"https://gomoku-game-p2p-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"gomoku-game-p2p",storageBucket:"gomoku-game-p2p.firebasestorage.app",messagingSenderId:"16145037845",appId:"1:16145037845:web:dc733365a8f54c4b31ac1c",measurementId:"G-L56S0FWWLT"}),h=(0,g.C3)(p),x=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=new Date().toISOString();t?console.log("[".concat(a,"] ").concat(e),t):console.log("[".concat(a,"] ").concat(e))},y=[{id:"rule_five_in_row",name:"5 in a row (Default)",description:"Win by placing 5 stones in a row (horizontally, vertically, or diagonally)",enabled:!0},{id:"rule_time_limit",name:"Time limit (Default)",description:"20 seconds per move, random move if time runs out",enabled:!0},{id:"rule_overlines",name:"Overlines win",description:"More than 5 stones in a row also counts as a win",enabled:!0},{id:"win_nullified_by_double_end_block",name:"Win nullified by double-end block",description:"A row of 5 or more stones is not considered a win if it is blocked at both ends by the opponent's stones",enabled:!0}];function b(e){let{board:t,isMyTurn:a,makeMove:s,myPlayerId:o,mapPlayerToSymbol:i,winner:l,gameState:d,boardSize:m,lastMove:u}=e,[f,g]=(0,n.useState)(null),[p,h]=(0,n.useState)(window.innerWidth);(0,n.useEffect)(()=>{let e=()=>h(window.innerWidth);return h(window.innerWidth),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]);let x=Math.min(40,Math.floor((p-(p<640?20:p<1024?60:120))/m)),y=.7*x,b=(e,r)=>{"playing"===d&&a&&null===t[e][r]&&!l&&s(e,r,o,!0)},v=(e,r)=>{"playing"===d&&a&&null===t[e][r]&&!l&&g({row:e,col:r})},j=()=>g(null),w=(e,t)=>u&&u.row===e&&u.col===t,N=e=>"X"===i(e)?"text-blue-600":"text-red-600",S=e=>"X"===i(e)?"bg-blue-50":"bg-red-50";return(0,r.jsx)("div",{className:"flex flex-col items-center justify-center w-full overflow-auto",children:(0,r.jsx)("div",{className:"relative bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-700 rounded-md shadow-md",style:{display:"grid",gridTemplateColumns:"repeat(".concat(m,", ").concat(x,"px)"),gridTemplateRows:"repeat(".concat(m,", ").concat(x,"px)"),gap:"1px"},children:t.map((e,t)=>e.map((e,n)=>(0,r.jsxs)("div",{className:c("flex items-center justify-center border border-gray-200 dark:border-gray-800 transition-all duration-300",{"cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700":"playing"===d&&a&&null===e&&!l,"bg-gray-50 dark:bg-gray-800":(null==f?void 0:f.row)===t&&(null==f?void 0:f.col)===n,[S(e||"")]:w(t,n)&&null!==e}),style:{width:"".concat(x,"px"),height:"".concat(x,"px"),fontSize:"".concat(y,"px"),boxShadow:w(t,n)?"inset 0 0 0 2px rgba(59, 130, 246, 0.5)":"none"},onClick:()=>b(t,n),onMouseEnter:()=>v(t,n),onMouseLeave:j,onTouchStart:()=>v(t,n),onTouchEnd:j,children:[e&&(0,r.jsx)("span",{className:c("font-bold",N(e)),children:i(e)}),null===e&&(null==f?void 0:f.row)===t&&(null==f?void 0:f.col)===n&&a&&(0,r.jsx)("span",{className:"text-gray-400 dark:text-gray-500 opacity-50",children:i(o)})]},"".concat(t,"-").concat(n))))})})}var v=a(9348);let j=(0,o.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),w=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(v.b,{ref:t,className:c(j(),a),...n})});w.displayName=v.b.displayName;var N=a(110),S=a(6722);let C=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(N.bL,{ref:t,className:c("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...n,children:(0,r.jsx)(N.C1,{className:c("flex items-center justify-center text-current"),children:(0,r.jsx)(S.A,{className:"h-4 w-4"})})})});C.displayName=N.bL.displayName;let k=n.forwardRef((e,t)=>{let{className:a,type:n,...s}=e;return(0,r.jsx)("input",{type:n,className:c("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...s})});k.displayName="Input";var R=a(2309);let I=R.bL,E=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(R.B8,{ref:t,className:c("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...n})});E.displayName=R.B8.displayName;let T=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(R.l9,{ref:t,className:c("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...n})});T.displayName=R.l9.displayName;let z=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(R.UC,{ref:t,className:c("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...n})});z.displayName=R.UC.displayName;var A=a(921),M=a(392),P=a(6801);let _=A.bL;A.YJ;let O=A.WT,D=n.forwardRef((e,t)=>{let{className:a,children:n,...s}=e;return(0,r.jsxs)(A.l9,{ref:t,className:c("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...s,children:[n,(0,r.jsx)(A.In,{asChild:!0,children:(0,r.jsx)(M.A,{className:"h-4 w-4 opacity-50"})})]})});D.displayName=A.l9.displayName;let G=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(A.PP,{ref:t,className:c("flex cursor-default items-center justify-center py-1",a),...n,children:(0,r.jsx)(P.A,{className:"h-4 w-4"})})});G.displayName=A.PP.displayName;let J=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(A.wn,{ref:t,className:c("flex cursor-default items-center justify-center py-1",a),...n,children:(0,r.jsx)(M.A,{className:"h-4 w-4"})})});J.displayName=A.wn.displayName;let K=n.forwardRef((e,t)=>{let{className:a,children:n,position:s="popper",...o}=e;return(0,r.jsx)(A.ZL,{children:(0,r.jsxs)(A.UC,{ref:t,className:c("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===s&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:s,...o,children:[(0,r.jsx)(G,{}),(0,r.jsx)(A.LM,{className:c("p-1","popper"===s&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:n}),(0,r.jsx)(J,{})]})})});K.displayName=A.UC.displayName,n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(A.JU,{ref:t,className:c("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...n})}).displayName=A.JU.displayName;let L=n.forwardRef((e,t)=>{let{className:a,children:n,...s}=e;return(0,r.jsxs)(A.q7,{ref:t,className:c("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...s,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(A.VF,{children:(0,r.jsx)(S.A,{className:"h-4 w-4"})})}),(0,r.jsx)(A.p4,{children:n})]})});function F(e){let{playerName:t,setPlayerName:a,boardSize:s,setBoardSize:o,joinRoomId:i,setJoinRoomId:l,roomId:c,createRoom:d,joinRoom:u,copyRoomId:f,gameRules:g,toggleGameRule:p,error:h}=e,[x,y]=(0,n.useState)("create");return(0,r.jsx)("div",{className:"w-full max-w-md mx-auto p-4",children:(0,r.jsxs)(I,{defaultValue:"create",className:"w-full",onValueChange:y,children:[(0,r.jsxs)(E,{className:"grid w-full grid-cols-2 mb-4",children:[(0,r.jsx)(T,{value:"create",children:"Create Game"}),(0,r.jsx)(T,{value:"join",children:"Join Game"})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)(w,{htmlFor:"playerName",className:"block mb-2",children:"Your Name"}),(0,r.jsx)(k,{id:"playerName",placeholder:"Enter your name",value:t,onChange:e=>a(e.target.value),className:"w-full"})]}),(0,r.jsx)(z,{value:"create",className:"space-y-4",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(w,{className:"block mb-2",children:"Board Size"}),(0,r.jsxs)(_,{value:s.toString(),onValueChange:e=>o(Number.parseInt(e)),children:[(0,r.jsx)(D,{className:"w-full",children:(0,r.jsx)(O,{placeholder:"Select board size"})}),(0,r.jsxs)(K,{children:[(0,r.jsx)(L,{value:"15",children:"15x15 (Standard)"}),(0,r.jsx)(L,{value:"25",children:"25x25 (Advanced)"})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(w,{className:"block mb-2",children:"Game Rules"}),(0,r.jsx)("div",{className:"space-y-2",children:g.map(e=>(0,r.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,r.jsx)(C,{id:e.id,checked:e.enabled,onCheckedChange:()=>p(e.id),disabled:["rule_five_in_row","rule_time_limit"].includes(e.id)}),(0,r.jsxs)("div",{children:[(0,r.jsx)(w,{htmlFor:e.id,className:"font-medium",children:e.name}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:e.description})]})]},e.id))})]}),(0,r.jsx)(m,{onClick:d,className:"w-full",children:"Create Game"})]})}),(0,r.jsxs)(z,{value:"join",className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(w,{htmlFor:"roomCode",className:"block mb-2",children:"Room Code"}),(0,r.jsx)(k,{id:"roomCode",placeholder:"Enter room code",value:i,onChange:e=>l(e.target.value),className:"w-full"})]}),(0,r.jsx)(m,{onClick:u,className:"w-full",children:"Join Game"})]}),h&&(0,r.jsx)("div",{className:"mt-4 p-3 bg-red-50 text-red-600 rounded-md",children:h})]})})}L.displayName=A.q7.displayName,n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(A.wv,{ref:t,className:c("-mx-1 my-1 h-px bg-muted",a),...n})}).displayName=A.wv.displayName;var U=a(7188);function W(e){let{displayTimer:t,timerActive:a,isMyTurn:n,opponentName:s}=e;return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center p-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,r.jsx)(U.A,{className:"h-5 w-5 ".concat(a?"animate-pulse text-amber-500":"")}),(0,r.jsxs)("span",{className:"font-medium",children:[n?"Your":"".concat(s,"'s")," turn"]})]}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("span",{className:"text-2xl font-mono font-bold ".concat(t<=3?"text-red-500":""),children:Math.ceil(t)}),(0,r.jsx)("span",{className:"text-sm ml-1",children:"seconds"})]})]})}let X=(0,o.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Z(e){let{className:t,variant:a,...n}=e;return(0,r.jsx)("div",{className:c(X({variant:a}),t),...n})}var q=a(1107),V=a(2486),Y=a(8822),B=a(7849),H=a(5836),Q=a(8022);let $=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(H.bL,{className:c("grid gap-2",a),...n,ref:t})});$.displayName=H.bL.displayName;let ee=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(H.q7,{ref:t,className:c("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),...n,children:(0,r.jsx)(H.C1,{className:"flex items-center justify-center",children:(0,r.jsx)(Q.A,{className:"h-2.5 w-2.5 fill-current text-current"})})})});function et(e){let{gameState:t,message:a,connectionStatus:s,isMyTurn:o,playerName:i,opponentName:l,mySymbol:c,opponentSymbol:d,setMySymbol:u,setOpponentSymbol:f,turnTimer:g,timerActive:p,winner:h,resetGame:x,restartGame:y,debugMode:b,currentPlayerId:v,board:j,makeMove:N,myPlayerId:S,waitingForRestart:C,opponentWantsRestart:k,restartCountdown:R,scores:I,opponentPlayerId:E,displayTimer:T}=e,[z,A]=(0,n.useState)(!1);return(0,r.jsxs)("div",{className:"w-full max-w-lg mx-auto p-6 space-y-4",children:[(0,r.jsxs)("div",{className:"flex flex-row flex-wrap sm:flex-nowrap justify-between items-start sm:items-center gap-2",children:["playing"===t&&!h&&(0,r.jsx)("div",{className:"flex justify-end space-x-2",children:(0,r.jsx)(m,{onClick:x,variant:"outline",size:"sm",className:"text-red-600",children:"Quit Game"})}),b&&(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:["Connection: ",s]}),(0,r.jsx)("div",{className:"flex justify-end space-x-2",children:(0,r.jsx)("div",{children:(0,r.jsxs)(Z,{variant:"playing"===t?"default":"outline",children:["initial"===t&&"Ready to Play","creating"===t&&"Creating Game...","joining"===t&&"Joining Game...","playing"===t&&"Game in Progress"]})})})]}),"playing"===t&&(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)(m,{variant:"outline",size:"sm",onClick:()=>A(!z),className:"w-full flex items-center justify-center gap-2",children:[(0,r.jsx)(q.A,{className:"h-4 w-4"}),z?"Hide Symbol Settings":"Change Symbol Display"]}),z&&(0,r.jsxs)("div",{className:"mt-3 p-3 border rounded-md",children:[(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsx)(w,{className:"text-sm font-medium",children:"Your Symbol Display"}),(0,r.jsxs)($,{value:c,onValueChange:e=>u(e),className:"flex space-x-4 mt-1",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(ee,{value:"X",id:"my-symbol-x"}),(0,r.jsx)(w,{htmlFor:"my-symbol-x",className:"text-blue-600 font-bold",children:"X"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(ee,{value:"O",id:"my-symbol-o"}),(0,r.jsx)(w,{htmlFor:"my-symbol-o",className:"text-red-600 font-bold",children:"O"})]})]})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-3",children:"These settings only affect how the game appears on your screen. They don't change the actual game state."})]})]}),"playing"===t&&(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"p-3 rounded-md ".concat(o&&!h?"bg-blue-100 border border-white border-blue-700 dark:bg-blue-950 dark:border-blue-800":"bg-gray-100 border border-gray-300 dark:bg-gray-800 dark:border-gray-700"),children:[(0,r.jsx)("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:"You"}),(0,r.jsxs)("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:[i,"   ",(0,r.jsxs)("span",{className:"ml-1 font-bold ".concat("X"===c?"text-blue-600 dark:text-blue-400":"text-red-600 dark:text-red-400"),children:["(",c,")"]}),(0,r.jsxs)("div",{className:"text-sm font-semibold",children:[I[S]," wins"]})]})]}),(0,r.jsxs)("div",{className:"p-3 rounded-md ".concat(o||h?"bg-gray-100 border border-gray-300 dark:bg-gray-800 dark:border-gray-700":"bg-blue-100 border border-white border-blue-700 dark:bg-blue-950 dark:border-blue-800"),children:[(0,r.jsx)("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:"Opponent"}),(0,r.jsxs)("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:[l||"Waiting...","   ",(0,r.jsxs)("span",{className:"ml-1 font-bold ".concat("X"===d?"text-blue-600 dark:text-blue-400":"text-red-600 dark:text-red-400"),children:["(",d,")"]}),(0,r.jsxs)("div",{className:"text-sm font-semibold",children:[I[E]," wins"]})]})]})]}),"playing"===t&&!h&&(0,r.jsx)("div",{className:"mb-4 ".concat(o?"bg-blue-100 dark:bg-blue-900 rounded-md":""),children:(0,r.jsx)(W,{displayTimer:T,timerActive:p,isMyTurn:o,opponentName:l})}),(h||C||k)&&(0,r.jsxs)("div",{className:"text-center p-4 bg-yellow-100 border border-white dark:bg-yellow-900 dark:border-yellow-700 rounded-md",children:[h&&(0,r.jsx)("div",{className:"font-bold text-lg mb-2",children:h===S?"\uD83C\uDF89 You Won! \uD83C\uDF89":"Game Over - You Lost"}),C&&(0,r.jsxs)("div",{className:"mb-2",children:[(0,r.jsx)("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:"Waiting for opponent to confirm..."}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-1",children:"You'll be notified when they're ready"})]}),k&&(0,r.jsxs)("div",{className:"mb-2",children:[(0,r.jsx)("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:"Opponent wants to play again"}),(0,r.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-1",children:["Auto-confirming in ",(0,r.jsx)("span",{className:"font-bold text-amber-600",children:R})," seconds"]})]}),(0,r.jsxs)("div",{className:"flex justify-center space-x-2 mt-2",children:[(0,r.jsxs)(m,{onClick:y,size:"sm",disabled:C,children:[(0,r.jsx)(V.A,{className:"h-4 w-4 mr-2"}),k?"Confirm":"Play Again"]}),(0,r.jsxs)(m,{onClick:x,variant:"outline",size:"sm",children:[(0,r.jsx)(Y.A,{className:"h-4 w-4 mr-2"}),"New Game"]})]})]}),"playing"===t&&"Connection: connected"!==s&&"ICE connection: connected"!==s&&"ICE connection: completed"!==s&&(0,r.jsxs)("div",{className:"flex items-center p-3 bg-amber-50 text-amber-700 rounded-md",children:[(0,r.jsx)(B.A,{className:"h-4 w-4 mr-2 flex-shrink-0"}),(0,r.jsx)("span",{className:"text-sm",children:"Connection may be unstable. If the game freezes, try refreshing the page."})]})]})}ee.displayName=H.q7.displayName;var ea=a(2184),er=a(1516),en=a(8295),es=a(7135),eo=a(813),ei=a(3602);let el=eo.bL,ec=eo.l9;eo.YJ,eo.ZL,eo.Pb,eo.z6,n.forwardRef((e,t)=>{let{className:a,inset:n,children:s,...o}=e;return(0,r.jsxs)(eo.ZP,{ref:t,className:c("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",n&&"pl-8",a),...o,children:[s,(0,r.jsx)(ei.A,{className:"ml-auto"})]})}).displayName=eo.ZP.displayName,n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(eo.G5,{ref:t,className:c("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...n})}).displayName=eo.G5.displayName;let ed=n.forwardRef((e,t)=>{let{className:a,sideOffset:n=4,...s}=e;return(0,r.jsx)(eo.ZL,{children:(0,r.jsx)(eo.UC,{ref:t,sideOffset:n,className:c("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...s})})});ed.displayName=eo.UC.displayName;let em=n.forwardRef((e,t)=>{let{className:a,inset:n,...s}=e;return(0,r.jsx)(eo.q7,{ref:t,className:c("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",n&&"pl-8",a),...s})});function eu(){let{setTheme:e}=(0,es.D)();return(0,r.jsxs)(el,{children:[(0,r.jsx)(ec,{asChild:!0,children:(0,r.jsxs)(m,{variant:"ghost",size:"icon",children:[(0,r.jsx)(er.A,{className:"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"}),(0,r.jsx)(en.A,{className:"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),(0,r.jsx)("span",{className:"sr-only",children:"Toggle theme"})]})}),(0,r.jsxs)(ed,{align:"end",children:[(0,r.jsx)(em,{onClick:()=>e("light"),children:"Light"}),(0,r.jsx)(em,{onClick:()=>e("dark"),children:"Dark"}),(0,r.jsx)(em,{onClick:()=>e("system"),children:"System"})]})]})}em.displayName=eo.q7.displayName,n.forwardRef((e,t)=>{let{className:a,children:n,checked:s,...o}=e;return(0,r.jsxs)(eo.H_,{ref:t,className:c("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:s,...o,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(eo.VF,{children:(0,r.jsx)(S.A,{className:"h-4 w-4"})})}),n]})}).displayName=eo.H_.displayName,n.forwardRef((e,t)=>{let{className:a,children:n,...s}=e;return(0,r.jsxs)(eo.hN,{ref:t,className:c("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...s,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(eo.VF,{children:(0,r.jsx)(Q.A,{className:"h-2 w-2 fill-current"})})}),n]})}).displayName=eo.hN.displayName,n.forwardRef((e,t)=>{let{className:a,inset:n,...s}=e;return(0,r.jsx)(eo.JU,{ref:t,className:c("px-2 py-1.5 text-sm font-semibold",n&&"pl-8",a),...s})}).displayName=eo.JU.displayName,n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(eo.wv,{ref:t,className:c("-mx-1 my-1 h-px bg-muted",a),...n})}).displayName=eo.wv.displayName;var ef=a(5283),eg=a(678),ep=a(3807);let eh=ep.bL,ex=ep.l9,ey=n.forwardRef((e,t)=>{let{className:a,align:n="center",sideOffset:s=4,...o}=e;return(0,r.jsx)(ep.ZL,{children:(0,r.jsx)(ep.UC,{ref:t,align:n,sideOffset:s,className:c("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...o})})});ey.displayName=ep.UC.displayName;let eb=[{name:"1",url:"/emojis/1.gif"},{name:"2",url:"/emojis/2.gif"},{name:"512",url:"/emojis/512.gif"},{name:"grinning-face",url:"/emojis/grinning-face.gif"},{name:"face-with-tears-of-joy",url:"/emojis/face-with-tears-of-joy.gif"},{name:"smiling-face-with-heart-eyes",url:"/emojis/smiling-face-with-heart-eyes.gif"},{name:"thinking-face",url:"/emojis/thinking-face.gif"},{name:"thumbs-up",url:"/emojis/thumbs-up.gif"}];function ev(e){let{onEmojiSelect:t}=e,[a,s]=(0,n.useState)(!1);return(0,r.jsx)("div",{className:"fixed bottom-4 right-4 z-10",children:(0,r.jsxs)(eh,{open:a,onOpenChange:s,children:[(0,r.jsx)(ex,{asChild:!0,children:(0,r.jsx)(m,{variant:"outline",size:"icon",className:"rounded-full h-12 w-12 bg-white dark:bg-gray-800 shadow-md hover:shadow-lg transition-all",children:(0,r.jsx)(eg.A,{className:"h-6 w-6"})})}),(0,r.jsx)(ey,{className:"w-64 p-2",side:"top",children:(0,r.jsx)("div",{className:"grid grid-cols-5 gap-2",children:eb.map(e=>(0,r.jsx)(m,{variant:"ghost",className:"p-2 h-12 w-12 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>{t(e.name),s(!1)},children:(0,r.jsx)("img",{src:e.url,alt:e.name,className:"h-8 w-8 object-contain"})},e.name))})})]})})}function ej(e){let{message:t,playerName:a,opponentName:s,myPlayerId:o}=e,[i,l]=(0,n.useState)([]),[c,d]=(0,n.useState)(!1),m=(0,n.useRef)(null);(0,n.useEffect)(()=>{if(!t)return;let e="".concat(Date.now(),"-").concat(Math.random()),a={...t,id:e,timestamp:Date.now()};l(e=>[...e,a]),d(!0)},[t]),(0,n.useEffect)(()=>(c&&null===m.current&&(m.current=setInterval(()=>{let e=Date.now();l(t=>t.filter(t=>e-t.timestamp<6e3))},2e3)),0===i.length&&m.current&&(clearInterval(m.current),m.current=null,d(!1)),()=>{m.current&&(clearInterval(m.current),m.current=null)}),[i,c]);let u=e=>{let t=eb.reduce((e,t)=>(e[t.name]=t.url,e),{});return t[e]||t["grinning-face"]};return(0,r.jsx)(r.Fragment,{children:i.map(e=>{let t=e.sender===o,n=u(e.emoji);return(0,r.jsx)("div",{className:"fixed top-1/2 transform -translate-y-1/2 z-50 animate-in fade-in zoom-in duration-300 ".concat(t?"left-10":"right-10"),style:{top:"calc(50% - 100px)"},children:(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[(0,r.jsx)("img",{src:n,alt:e.emoji,className:"h-24 w-24 mb-2"}),(0,r.jsx)("div",{className:"bg-white dark:bg-gray-800 px-3 py-1 rounded-full shadow-md text-sm",children:t?a:s})]})},e.id)})})}function ew(e){let{isWinner:t,playerName:s}=e,o=(0,n.useRef)(null),i=(0,n.useRef)(null),l=(0,n.useRef)(null),[c,d]=(0,n.useState)(null);(0,n.useEffect)(()=>{(async()=>{try{if(!c){let e=await a.e(782).then(a.t.bind(a,5008,23));d(e.default)}t&&!i.current&&(i.current=(await a.e(357).then(a.bind(a,2357))).default)}catch(e){console.error("Error loading libraries:",e)}})()},[t,c]),(0,n.useEffect)(()=>{if(!c)return;(async()=>{if(t){o.current||(o.current=new Audio("/sounds/victory.mp3"),o.current.volume=.5);try{await o.current.play()}catch(e){console.error("Error playing audio:",e)}i.current&&m()}})();let e=setTimeout(()=>{o.current&&(o.current.pause(),o.current.currentTime=0)},5200);return()=>{clearTimeout(e),o.current&&(o.current.pause(),o.current.currentTime=0)}},[t,c]);let m=()=>{if(!i.current)return;let e=["square","circle","star","triangle","polygon","emoji"],t=e[Math.floor(Math.random()*e.length)],a=Date.now()+5200,r={startVelocity:25,spread:360,ticks:60,zIndex:1e3,colors:["#00ffff","#ff00ff","#ffffff","#ffd700","#ff4500","#00ff00","#1e90ff","#ff1493","#adff2f","#ff6347","#8a2be2","#f08080"]},n=setInterval(()=>{let e=a-Date.now();if(e<=0)return clearInterval(n);i.current({...r,particleCount:e/5200*100,angle:360*Math.random(),spread:100*Math.random()+50,origin:{x:.3*Math.random()+.3,y:.3*Math.random()+.3},shapes:[t]})},100)};return(0,r.jsx)("div",{className:"fixed inset-0 z-50 pointer-events-none bg-transparent",children:!t&&(0,r.jsx)("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 animate-in fade-in zoom-in duration-300",children:(0,r.jsx)("div",{ref:l,className:"h-24 w-24 dark:invert"})})})}function eN(e){let{isWinner:t,playerName:a}=e,s=(0,n.useRef)(null),o=(0,n.useRef)(null),[i,l]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{if(t)s.current&&i&&(s.current.pause(),s.current.currentTime=0,l(!1),console.log("isWinner true: Defeat audio stopped")),o.current&&(o.current.src="");else{if(s.current||(s.current=new Audio("/sounds/defeat.mp3"),s.current.volume=.5),!i){let e=s.current.play();void 0!==e&&e.then(()=>{console.log("Defeat audio playing"),l(!0)}).catch(e=>{console.error("Error playing audio:",e)})}o.current&&(o.current.src="/emojis/face-with-tears-of-joy.gif");let e=setTimeout(()=>{s.current&&(s.current.pause(),s.current.currentTime=0,l(!1),console.log("Defeat audio stopped after 8 seconds"))},8e3);return()=>{clearTimeout(e),s.current&&i&&(s.current.pause(),s.current.currentTime=0,l(!1),console.log("Cleanup: Defeat audio paused"))}}},[t,i]),(0,r.jsx)("div",{className:"fixed inset-0 z-50 pointer-events-none",children:!t&&(0,r.jsx)("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 animate-in fade-in zoom-in duration-300",children:(0,r.jsx)("img",{ref:o,className:"h-24 w-24",alt:"Sad emoji"})})})}function eS(){let[e,t]=(0,n.useState)(!1),a=function(){let[e,t]=(0,n.useState)("initial"),[a,r]=(0,n.useState)(""),[s,o]=(0,n.useState)(""),[i,l]=(0,n.useState)(!1),[c,d]=(0,n.useState)(!1),[m,f]=(0,n.useState)(null),[p,b]=(0,n.useState)(!1),[v,j]=(0,n.useState)(!1),[w,N]=(0,n.useState)(!1),[S,C]=(0,n.useState)(9),[k,R]=(0,n.useState)(null),[I,E]=(0,n.useState)(""),[T,z]=(0,n.useState)(""),[A,M]=(0,n.useState)("X"),[P,_]=(0,n.useState)("O"),[O,D]=(0,n.useState)({hostSymbol:"X",guestSymbol:"O"}),[G,J]=(0,n.useState)(!0),[K,L]=(0,n.useState)({host:0,guest:0}),[F,U]=(0,n.useState)(null),[W,X]=(0,n.useState)(!1),Z=e=>{i?"X"===e?(D({hostSymbol:"X",guestSymbol:"O"}),M("X"),_("O")):(M("O"),_("X"),D({hostSymbol:"O",guestSymbol:"X"})):"X"===e?(D({hostSymbol:"O",guestSymbol:"X"}),M("X"),_("O")):(M("O"),_("X"),D({hostSymbol:"X",guestSymbol:"O"}))},{roomId:q,joinRoomId:V,setJoinRoomId:Y,generateRoomId:B,copyRoomId:H}=function(){let[e,t]=(0,n.useState)(""),[a,r]=(0,n.useState)(""),s=(0,n.useCallback)(()=>{let e=Math.floor(1e5+9e5*Math.random()).toString();return t(e),e},[]),o=(0,n.useCallback)(()=>(navigator.clipboard.writeText(e),e),[e]);return{roomId:e,setRoomId:t,joinRoomId:a,setJoinRoomId:r,generateRoomId:s,copyRoomId:o}}(),{board:Q,setBoard:$,boardSize:ee,setBoardSize:et,createEmptyBoard:ea,makeMove:er,checkWinner:en,currentPlayerId:es}=function(){let[e,t]=(0,n.useState)(15),[a,r]=(0,n.useState)(()=>u(e)),[s,o]=(0,n.useState)("host");(0,n.useEffect)(()=>{r(u(e))},[e]);let i=(0,n.useCallback)(function(e,t,n){arguments.length>3&&void 0!==arguments[3]&&arguments[3];let s=JSON.parse(JSON.stringify(a));s[e][t]=n,r(s),console.log("Move made by",n,"at",e,t);let i="host"===n?"guest":"host";return o(i),{newBoard:s,nextPlayerId:i}},[a]);return{board:a,setBoard:r,boardSize:e,setBoardSize:t,currentPlayerId:s,setCurrentPlayerId:o,createEmptyBoard:u,makeMove:i,checkWinner:(0,n.useCallback)((e,t,a,r,n)=>{var s,o,i,l;let c=e.length,d=null===(i=null===(s=n.find(e=>"rule_five_in_row"===e.id))||void 0===s?void 0:s.enabled)||void 0===i||i,m=null===(l=null===(o=n.find(e=>"rule_overlines"===e.id))||void 0===o?void 0:o.enabled)||void 0===l||l;for(let[n,s]of[[0,1],[1,0],[1,1],[1,-1]]){let o=1,i=[!1,!1],l=1;for(;l<5;){let i=t+l*n,d=a+l*s;if(i<0||i>=c||d<0||d>=c)break;if(e[i][d]===r)o++,l++;else break}let u=t+l*n,f=a+l*s;for(;u>=0&&u<c&&f>=0&&f<c;){if(null===e[u][f]){u+=n,f+=s;continue}e[u][f]!==r&&(i[0]=!0);break}for(l=1;l<5;){let i=t-l*n,d=a-l*s;if(i<0||i>=c||d<0||d>=c)break;if(e[i][d]===r)o++,l++;else break}for(u=t-l*n,f=a-l*s;u>=0&&u<c&&f>=0&&f<c;){if(null===e[u][f]){u-=n,f-=s;continue}e[u][f]!==r&&(i[1]=!0);break}if(d&&5===o||m&&o>5||(m||!(o>5))&&d&&5===o)return!0}return!1},[])}}(),{gameRules:eo,toggleGameRule:ei,setGameRules:el}=function(){let[e,t]=(0,n.useState)(y);return{gameRules:e,setGameRules:t,toggleGameRule:e=>{t(t=>t.map(t=>t.id===e?{...t,enabled:!t.enabled}:t))}}}(),{peerConnection:ec,dataChannel:ed,connectionStatus:em,setConnectionStatus:eu,setupPeerConnection:ef,setupDataChannel:eg,cleanupConnection:ep,dataChannelRef:eh}=function(){let[e,t]=(0,n.useState)(null),[a,r]=(0,n.useState)(null),[s,o]=(0,n.useState)("Not connected"),i=(0,n.useRef)([]),l=(0,n.useRef)(!1),c=(0,n.useRef)(null),d=(0,n.useRef)(null),m=(0,n.useCallback)(async(e,a,r,n,s,o,m,p,y,b)=>{l.current=!1,i.current=[];let v=null;if(a)await (0,g.hZ)((0,g.KR)(h,"rooms/".concat(e)),{created:Date.now(),status:"waiting",hostConnected:!1,peerConnected:!1,hostName:r,boardSize:n,gameRules:s}),x("Room ".concat(e," created in Firebase"));else{let t=(0,g.KR)(h,"rooms/".concat(e)),a=await (0,g.Jt)(t);if(!a.exists())throw Error("Room not found");v=a.val(),x("Room ".concat(e," found, status:"),v),y(v.hostName),await (0,g.yo)((0,g.KR)(h,"rooms/".concat(e)),{status:"peer_joining",peerName:r})}let j=u(e,a,o,m,p,y,b);if(t(j),c.current=j,a){let t=j.createDataChannel("game");f(t,e,a,o,m,p),d.current=t,x("Data channel created");try{x("Creating offer...");let t=await j.createOffer();await j.setLocalDescription(t),x("Local description set",t),await (0,g.hZ)((0,g.KR)(h,"rooms/".concat(e,"/offer")),{type:t.type,sdp:t.sdp}),x("Offer saved to Firebase"),await (0,g.yo)((0,g.KR)(h,"rooms/".concat(e)),{status:"waiting_for_peer"}),setTimeout(()=>{(0,g.Jt)((0,g.KR)(h,"rooms/".concat(e,"/answer"))).then(t=>{t.exists()||(0,g.TF)((0,g.KR)(h,"rooms/".concat(e)))})},36e5);let a=(0,g.KR)(h,"rooms/".concat(e,"/answer"));(0,g.Zy)(a,async t=>{let a=t.val();if(a){x("Got answer from remote",a);try{if("closed"!==j.signalingState&&"stable"!==j.signalingState){if(await j.setRemoteDescription(new RTCSessionDescription(a)),x("Remote description set"),l.current=!0,p("Remote description set, processing candidates..."),i.current.length>0){for(let e of(x("Processing ".concat(i.current.length," pending ICE candidates")),i.current))try{await j.addIceCandidate(e),x("Added pending ICE candidate")}catch(e){console.error("Error adding pending ICE candidate:",e)}i.current=[]}await (0,g.yo)((0,g.KR)(h,"rooms/".concat(e)),{status:"connecting",hostProcessedAnswer:!0})}else x("Skipping setRemoteDescription, signaling state:",j.signalingState)}catch(e){console.error("Error setting remote description:",e),p("Failed to set remote description")}}});let r=(0,g.KR)(h,"rooms/".concat(e,"/calleeCandidates"));(0,g.Zy)(r,e=>{let t=e.val();t&&Object.values(t).forEach(async e=>{if(x("Received ICE candidate from remote",e),l.current)try{await j.addIceCandidate(new RTCIceCandidate(e)),x("Added ICE candidate from remote")}catch(e){console.error("Error adding ICE candidate:",e)}else x("Storing ICE candidate for later"),i.current.push(new RTCIceCandidate(e))})})}catch(t){throw console.error("Error creating offer:",t),j.close(),(0,g.TF)((0,g.KR)(h,"rooms/".concat(e))),t}}else{console.log("Joining peer, waiting for offer...");try{let t=(0,g.KR)(h,"rooms/".concat(e,"/offer")),a=(await (0,g.Jt)(t)).val();if(x("Got offer from Firebase",a),!a)throw Error("Room offer not found");if(x("Setting remote description..."),await j.setRemoteDescription(new RTCSessionDescription(a)),x("Remote description set"),l.current=!0,p("Remote description set, creating answer..."),i.current.length>0){for(let e of(x("Processing ".concat(i.current.length," pending ICE candidates")),i.current))try{await j.addIceCandidate(e),x("Added pending ICE candidate")}catch(e){console.error("Error adding pending ICE candidate:",e)}i.current=[]}x("Creating answer...");let r=await j.createAnswer();await j.setLocalDescription(r),x("Local description set",r),await (0,g.hZ)((0,g.KR)(h,"rooms/".concat(e,"/answer")),{type:r.type,sdp:r.sdp,timestamp:Date.now()}),x("Answer saved to Firebase"),await (0,g.yo)((0,g.KR)(h,"rooms/".concat(e)),{status:"connecting"});let n=(0,g.KR)(h,"rooms/".concat(e,"/callerCandidates"));(0,g.Zy)(n,e=>{let t=e.val();t&&Object.values(t).forEach(async e=>{if(x("Received ICE candidate from remote",e),l.current)try{await j.addIceCandidate(new RTCIceCandidate(e)),x("Added ICE candidate from remote")}catch(e){console.error("Error adding ICE candidate:",e)}else x("Storing ICE candidate for later"),i.current.push(new RTCIceCandidate(e))})})}catch(e){throw console.error("Error during WebRTC signaling:",e),j.close(),e}}return v},[]),u=(e,t,a,r,n,s,o)=>{let i={iceServers:[{urls:"turn:global.relay.metered.ca:80?transport=tcp",username:"a497ecb3de46ea48c9890efb",credential:"22SI8daINmoUfpUA"},{urls:"turn:global.relay.metered.ca:443?transport=tcp",username:"a497ecb3de46ea48c9890efb",credential:"22SI8daINmoUfpUA"},{urls:"turns:global.relay.metered.ca:443?transport=tcp",username:"a497ecb3de46ea48c9890efb",credential:"22SI8daINmoUfpUA"}],iceCandidatePoolSize:10,iceTransportPolicy:"relay"};x("Creating peer connection with config:",i);let l=new RTCPeerConnection(i);return l.onicecandidate=a=>{if(a.candidate){x("Generated ICE candidate",a.candidate);let r="rooms/".concat(e,"/").concat(t?"callerCandidates":"calleeCandidates","/").concat(Date.now());(0,g.hZ)((0,g.KR)(h,r),a.candidate.toJSON())}},l.onicegatheringstatechange=()=>{x("ICE gathering state:",l.iceGatheringState),n("ICE gathering: ".concat(l.iceGatheringState))},l.oniceconnectionstatechange=async()=>{if(x("ICE connection state:",l.iceConnectionState),n("ICE connection: ".concat(l.iceConnectionState)),"connected"===l.iceConnectionState||"completed"===l.iceConnectionState){await (0,g.yo)((0,g.KR)(h,"rooms/".concat(e)),{[t?"hostConnected":"peerConnected"]:!0,status:t?"host_connected":"peer_connected"});let n=(await (0,g.Jt)((0,g.KR)(h,"rooms/".concat(e)))).val();n&&(t&&n.peerConnected?(a("playing"),s(n.peerName),r(""),console.log("Both sides connected, starting game",t,o)):!t&&n.hostConnected&&(s(n.hostName),a("playing"),r("")))}},l.onsignalingstatechange=()=>{x("Signaling state:",l.signalingState)},l.onconnectionstatechange=async()=>{x("Connection state:",l.connectionState),n("Connection: ".concat(l.connectionState)),"connected"===l.connectionState&&(x("WebRTC connection established!"),await (0,g.yo)((0,g.KR)(h,"rooms/".concat(e)),{[t?"hostConnected":"peerConnected"]:!0,status:"connected"}))},t||(l.ondatachannel=s=>{x("Data channel received"),f(s.channel,e,t,a,r,n),d.current=s.channel}),l},f=(e,t,a,n,s,o)=>{e.onopen=async()=>{x("Data channel is open"),t&&await (0,g.yo)((0,g.KR)(h,"rooms/".concat(t)),{[a?"hostConnected":"peerConnected"]:!0,dataChannelOpen:!0})},e.onclose=()=>{x("Data channel closed")},e.onerror=e=>{console.error("Data channel error:",e)},e.onmessage=e=>{try{x("Received message:",e.data)}catch(t){console.error("Error processing message:",t,e.data)}},r(e),d.current=e};return{peerConnection:e,dataChannel:a,connectionStatus:s,setConnectionStatus:o,setupPeerConnection:m,setupDataChannel:f,cleanupConnection:(0,n.useCallback)(e=>{e&&((0,g.AU)((0,g.KR)(h,"rooms/".concat(e,"/callerCandidates"))),(0,g.AU)((0,g.KR)(h,"rooms/".concat(e,"/calleeCandidates"))),(0,g.AU)((0,g.KR)(h,"rooms/".concat(e,"/offer"))),(0,g.AU)((0,g.KR)(h,"rooms/".concat(e,"/answer"))),(0,g.AU)((0,g.KR)(h,"rooms/".concat(e))),(0,g.TF)((0,g.KR)(h,"rooms/".concat(e)))),c.current&&(c.current.close(),c.current=null),d.current&&(d.current.close(),d.current=null)},[]),dataChannelRef:d}}(),ex=()=>i?"host":"guest",ey=()=>i?"guest":"host",eb=e=>"host"===e?O.hostSymbol:"guest"===e?O.guestSymbol:null;(0,n.useEffect)(()=>{let e=["Alice","Bob","Charlie","Daisy","Ethan","Fiona"],t=Math.floor(Math.random()*e.length);E(e[t])},[]);let ev=function(e,t,a){var n,s;let o=!(arguments.length>3)||void 0===arguments[3]||arguments[3];if(null!=Q[e][t]){console.warn("\xd4 n\xe0y đ\xe3 được đ\xe1nh.");return}let i=er(e,t,a,o);if(console.log("handleMakeMove",e,t,a,o,i),R({row:e,col:t}),en(Q,e,t,a,eo))J(!G),f(a),r("".concat(eb(a)," thắng trận!")),d(eM(a)===ex()),ek(),L(e=>({...e,[a]:e[a]+1})),o&&(null===(n=eh.current)||void 0===n?void 0:n.readyState)==="open"&&(eh.current.send(JSON.stringify({type:"move",row:e,col:t,playerId:a,nextPlayer:a,winner:a})),X(!0),setTimeout(()=>{X(!1)},5e3));else{let r=eM(a);d(r===ex()),eC(),o&&(null===(s=eh.current)||void 0===s?void 0:s.readyState)==="open"&&eh.current.send(JSON.stringify({type:"move",row:e,col:t,playerId:a,nextPlayer:r}))}return i},{turnTimer:ej,timerActive:ew,setTurnTimerFactory:eN,setTimerActive:eS,startTurnTimer:eC,stopTurnTimer:ek,makeRandomMove:eR,displayTimer:eI}=function(e,t,a,r,s,o,i,l){let[c,d]=(0,n.useState)(20),[m,u]=(0,n.useState)(20),[f,g]=(0,n.useState)(!1),p=(0,n.useRef)(null),h=(0,n.useCallback)(()=>{p.current&&f&&(clearInterval(p.current),p.current=null),g(!1)},[]),x=()=>{console.log("Making random move for player:",l);let e=r.length,t=r[0].length,a=e*t;for(;a>0;){let n=Math.floor(Math.random()*e),s=Math.floor(Math.random()*t);if(null===r[n][s]){i(n,s,l,!0);return}a--}};return(0,n.useEffect)(()=>{u(20)},[o]),(0,n.useEffect)(()=>{t&&(u(0),g(!1))},[t]),(0,n.useEffect)(()=>{g(!0)},[s]),(0,n.useEffect)(()=>{let e=null;return f&&"playing"===s&&(u(c),e=setInterval(()=>{u(e=>e>0?e-1:0)},1e3)),()=>{e&&clearInterval(e)}},[f,s]),(0,n.useEffect)(()=>{0!==m||t||(e&&"function"==typeof i&&x(),console.log("Kh\xf4ng c\xf2n \xf4 trống để đ\xe1nh."))},[m]),(0,n.useEffect)(()=>()=>{h()},[h]),{displayTimer:m,turnTimer:c,setDisplayTimer:u,startTurnTimer:()=>{g(!0)},stopTurnTimer:h,makeRandomMove:x,setTimerActive:g,timerActive:f,setTurnTimerFactory:()=>{d(20)}}}(c,m,0,Q,e,es,ev,ex()),eE=(0,n.useRef)(ea(ee)),eT=(0,n.useRef)(null),ez=(0,n.useRef)(ee),eA=(0,n.useRef)(null),eM=e=>"host"===e?"guest":"host",eP=async()=>{try{if(o(""),!I.trim()){o("Please enter your name");return}t("creating");let e=B();l(!0),d(!0),J(!0),L({host:0,guest:0}),ez.current=ee,eE.current=ea(ee),await ef(e,!0,I,ee,eo,t,r,eu,z,eC),r("Room created! Share this code with your friend: ".concat(e))}catch(e){console.error("Error creating room:",e),o("Failed to create room. Please try again."),t("initial")}};(0,n.useEffect)(()=>{},[c]);let e_=async()=>{try{if(o(""),!V){o("Please enter a room code");return}if(!I.trim()){o("Please enter your name");return}L({host:0,guest:0}),t("joining"),l(!1),d(!1),Z("O"),J(!0);let e=await ef(V,!1,I,ee,eo,t,r,eu,z,eC);if(e){let t=e.boardSize;et(t),ez.current=t,eE.current=ea(t),e.gameRules&&!i&&el(e.gameRules)}r("Joining room... Establishing connection with host.")}catch(e){console.error("Error while joining room:",e),o("An unexpected error occurred. Please try again."),t("initial")}},eO=()=>{eA.current&&(clearInterval(eA.current),eA.current=null);let e=ea(ez.current);eE.current=e,et(ez.current),$(e);let t=i?!!G:!G;if(d(t),f(null),R(null),j(!1),N(!1),C(9),X(!1),U(null),eS(!0),t?(r("Your turn"),eC()):(r("".concat(T,"'s turn")),eN()),ed&&"open"===ed.readyState)try{ed.send(JSON.stringify({type:"restart_game_confirm",hostGoesFirst:!G}))}catch(e){console.error("Error sending restart game confirmation:",e)}};return(0,n.useEffect)(()=>{if(!ed)return;let e=e=>{try{let t=JSON.parse(e.data);switch(console.log("Received data channel message:",t),"ping"!==t.type&&eN(),t.type){case"move":void 0!==t.row&&void 0!==t.col&&t.playerId&&(ev(t.row,t.col,t.playerId,!1),R({row:t.row,col:t.col}),d(!0),eC());break;case"restartGame":eE.current=ea(ez.current),f(null),R(null),d(!i),i?(r("Your turn"),eC()):(r("Opponent's turn"),eN(),eS(!0));break;case"ping":break;case"timerSync":c||void 0===t.turnTimer||eN();break;case"restart_game_request":N(!0),r("Opponent wants to play again. Click 'Play Again' or wait for countdown."),C(9),eA.current&&clearInterval(eA.current),eA.current=setInterval(()=>{C(e=>{let t=e-1;return t<=0?(eO(),0):t})},1e3);break;case"restart_game_confirm":v&&eO();break;case"emoji":t.emoji&&t.sender&&(U({emoji:t.emoji,sender:t.sender}),setTimeout(()=>{console.log("Clearing emoji message"),U(null)},8e3));break;default:console.log("Unknown message type:",t.type)}}catch(t){console.error("Error processing message:",t,e.data)}};return ed.addEventListener("message",e),()=>{ed.removeEventListener("message",e)}},[ed,c,er,eC,eN,eS,v,q,ep]),(0,n.useEffect)(()=>{let t;return"playing"===e&&ed&&(t=setInterval(()=>{"open"===ed.readyState&&ed.send(JSON.stringify({type:"ping"}))},3e4)),()=>{t&&clearInterval(t)}},[e,ed]),(0,n.useEffect)(()=>{let t=()=>{if("playing"===e&&ed&&"open"===ed.readyState)try{ed.send(JSON.stringify({type:"disconnect"}))}catch(e){console.error("Error sending disconnect message:",e)}};return window.addEventListener("beforeunload",t),()=>{window.removeEventListener("beforeunload",t)}},[e,ed]),(0,n.useEffect)(()=>()=>{eT.current&&clearTimeout(eT.current),eA.current&&clearInterval(eA.current),ek(),ep(q)},[q,ek,ep]),{roomId:q,joinRoomId:V,gameState:e,message:a,error:s,isHost:i,board:Q,isMyTurn:c,winner:m,connectionStatus:em,debugMode:p,playerName:I,opponentName:T,boardSize:ee,turnTimer:ej,timerActive:ew,dataChannel:ed,symbolPreference:A,opponentSymbolPreference:P,setSymbolPreference:Z,setOpponentSymbolPreference:_,getMySymbol:()=>eb(ex()),getOpponentSymbol:()=>eb(ey()),mapPlayerToSymbol:eb,gameRules:eo,lastMove:k,setJoinRoomId:Y,setPlayerName:E,setBoardSize:et,toggleGameRule:ei,createRoom:eP,joinRoom:e_,makeMove:ev,resetGame:()=>{eT.current&&(clearTimeout(eT.current),eT.current=null),ek(),ep(q),t("initial"),r(""),o(""),l(!1),d(!1),j(!1),N(!1),C(9),f(null),eu("Not connected"),z(""),R(null);let e=ea(ee);eE.current=e,$(e),U(null),X(!1)},restartGame:()=>{if(w){eO();return}if(ek(),j(!0),r("Waiting for opponent to confirm restart..."),ed&&"open"===ed.readyState)try{ed.send(JSON.stringify({type:"restart_game_request"}))}catch(e){console.error("Error sending restart game request:",e)}},copyRoomId:H,toggleDebugMode:()=>{b(!p)},getMyPlayerId:ex,getOpponentPlayerId:ey,currentPlayerId:es,waitingForRestart:v,opponentWantsRestart:w,restartCountdown:S,confirmRestartGame:eO,scores:K,sendEmoji:e=>{if(ed&&"open"===ed.readyState)try{ed.send(JSON.stringify({type:"emoji",emoji:e,sender:ex()})),U({emoji:e,sender:ex()})}catch(e){console.error("Error sending emoji:",e)}},emojiMessage:F,showVictoryEffects:W,setTimerActive:eS,startTurnTimer:eC,stopTurnTimer:ek,makeRandomMove:eR,displayTimer:eI}}(),[s,o]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{if(a.winner){o(!0);let e=setTimeout(()=>{o(!1)},5e3);return()=>clearTimeout(e)}},[a.winner]),(0,n.useEffect)(()=>{t(!0)},[]),e)?(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[(0,r.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold text-center mb-6",children:"Caro Game"}),(0,r.jsx)("div",{className:"flex w-full max-w-md mx-auto justify-end mb-4",children:(0,r.jsx)(eu,{})}),"initial"===a.gameState&&(0,r.jsx)(F,{playerName:a.playerName,setPlayerName:a.setPlayerName,boardSize:a.boardSize,setBoardSize:a.setBoardSize,joinRoomId:a.joinRoomId,setJoinRoomId:a.setJoinRoomId,roomId:a.roomId,createRoom:a.createRoom,joinRoom:a.joinRoom,copyRoomId:a.copyRoomId,gameRules:a.gameRules,toggleGameRule:a.toggleGameRule,error:a.error}),("creating"===a.gameState||"joining"===a.gameState)&&(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center p-8",children:[(0,r.jsx)(ea.A,{className:"h-8 w-8 animate-spin text-blue-500 mb-4"}),(0,r.jsx)("p",{className:"text-lg text-center",children:"creating"===a.gameState?"Creating game...":"Joining game..."}),"creating"!==a.gameState&&(0,r.jsx)("p",{className:"text-sm text-gray-500 text-center mt-2",children:a.message||"Establishing connection..."}),"creating"===a.gameState&&(0,r.jsxs)("div",{className:"mt-4 p-3 rounded-md",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("span",{className:"font-medium",children:["Room Code: ",a.roomId]}),(0,r.jsx)(m,{variant:"outline",size:"icon",onClick:a.copyRoomId,title:"Copy Room Code",children:(0,r.jsx)(ef.A,{className:"h-4 w-4"})})]}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Share this code with your friend to join the game"})]})]}),"playing"===a.gameState&&(0,r.jsxs)("div",{className:"flex flex-col gap-6 items-center",children:[(0,r.jsx)("div",{className:"w-full order-2",children:(0,r.jsx)("div",{className:"overflow-auto flex justify-center",children:(0,r.jsx)(b,{board:a.board,isMyTurn:a.isMyTurn,makeMove:a.makeMove,myPlayerId:a.getMyPlayerId(),symbolPreference:a.symbolPreference,opponentSymbolPreference:a.opponentSymbolPreference,winner:a.winner,gameState:a.gameState,boardSize:a.boardSize,lastMove:a.lastMove,mapPlayerToSymbol:a.mapPlayerToSymbol})})}),(0,r.jsx)("div",{className:"w-full order-1",children:(0,r.jsx)(et,{gameState:a.gameState,message:a.message,connectionStatus:a.connectionStatus,isMyTurn:a.isMyTurn,playerName:a.playerName,opponentName:a.opponentName,mySymbol:a.symbolPreference,opponentSymbol:a.opponentSymbolPreference,setMySymbol:a.setSymbolPreference,setOpponentSymbol:a.setOpponentSymbolPreference,turnTimer:a.turnTimer,displayTimer:a.displayTimer,timerActive:a.timerActive,winner:a.winner,resetGame:a.resetGame,restartGame:a.restartGame,debugMode:a.debugMode,currentPlayerId:a.currentPlayerId,makeMove:a.makeMove,board:a.board,myPlayerId:a.getMyPlayerId(),waitingForRestart:a.waitingForRestart,opponentWantsRestart:a.opponentWantsRestart,restartCountdown:a.restartCountdown,scores:a.scores,opponentPlayerId:a.getOpponentPlayerId()})})]}),"playing"===a.gameState&&(0,r.jsxs)("div",{className:"w-full max-w-lg mx-auto p-6 space-y-4",children:[(0,r.jsx)("hr",{}),(0,r.jsx)("br",{}),(0,r.jsx)(w,{className:"block mb-2",children:"The game rules that apply in this room are:"}),(0,r.jsx)("div",{className:"space-y-2",children:a.gameRules.map(e=>(0,r.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,r.jsx)(C,{id:e.id,checked:e.enabled,disabled:!0}),(0,r.jsxs)("div",{children:[(0,r.jsx)(w,{htmlFor:e.id,className:"font-medium",children:e.name}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:e.description})]})]},e.id))})]}),"playing"===a.gameState&&(0,r.jsx)(ev,{onEmojiSelect:a.sendEmoji}),(0,r.jsx)(ej,{message:a.emojiMessage,playerName:a.playerName,opponentName:a.opponentName,myPlayerId:a.getMyPlayerId()}),a.showVictoryEffects&&a.winner&&(0,r.jsx)(ew,{isWinner:a.winner===a.getMyPlayerId(),playerName:a.winner===a.getMyPlayerId()?a.playerName:a.opponentName}),s&&!a.showVictoryEffects&&a.winner&&a.winner!==a.getMyPlayerId()&&(0,r.jsx)(eN,{isWinner:!1,playerName:a.winner===a.getMyPlayerId()?a.playerName:a.opponentName})]}):(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsx)(ea.A,{className:"h-8 w-8 animate-spin text-gray-500"})})}},2881:(e,t,a)=>{Promise.resolve().then(a.bind(a,2151))}},e=>{var t=t=>e(e.s=t);e.O(0,[842,585,497,954,358],()=>t(2881)),_N_E=e.O()}]);